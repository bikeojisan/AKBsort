<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AKB48ã‚½ãƒ¼ãƒˆ</title>
<style>
  /* BUILD: fixed v5 */
  :root{
    --gap: 14px;
    --card-max: clamp(150px, 42vw, 420px); /* å·¦å³ã‚«ãƒ¼ãƒ‰ã®æœ€å¤§å¹…ï¼ˆå¯å¤‰ï¼‰ */
    --center-w: clamp(80px, 12vw, 120px);  /* çœŸã‚“ä¸­åˆ—ã®å¹…ï¼ˆãƒœã‚¿ãƒ³åˆ—ï¼‰ */
    --btn-h: 56px;
    --radius: 18px;
  }

  *{box-sizing:border-box}
  body{font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", Arial, sans-serif; margin:0; background:#0b0d0f; color:#eef1f4;}
  header{display:flex; align-items:center; gap:12px; padding:14px 16px; border-bottom:1px solid #20252b; position:sticky; top:0; backdrop-filter: blur(6px); background:rgba(11,13,15,.7);}
  header h1{font-size:18px; margin:0; font-weight:700;}
  #progressWrap{display:flex; align-items:center; gap:12px; margin-left:auto; min-width:260px;}
  #bar{flex:1; height:10px; background:#1a1f25; border-radius:999px; overflow:hidden;}
  #bar>i{display:block; height:100%; width:0%; background:linear-gradient(90deg,#66d1ff,#7cffc4); transition:width .2s ease;}
  #pct{font-variant-numeric: tabular-nums; min-width:52px; text-align:right;}
  #count{font-variant-numeric: tabular-nums; font-size:12px; opacity:.8; white-space:nowrap;}
  main{max-width:1200px; margin:18px auto; padding:0 16px;}

  /* === å¸¸ã«æ¨ª3åˆ—ï¼ˆä¸­å¤®ã¯å›ºå®šå¹…ã€å·¦å³ã¯è‡ªå‹•ï¼‰ === */
  .arena{ display:grid; grid-template-columns: minmax(0,1fr) var(--center-w) minmax(0,1fr); align-items:center; gap: var(--gap); }
  .side{ display:flex; flex-direction:column; align-items:center; gap:12px; width:100%; min-width:0; }
  .tieCol{ width: var(--center-w); display:flex; align-items:center; justify-content:center; }

  /* ã‚«ãƒ¼ãƒ‰ã¯åˆ—å¹…ã«ãƒ•ã‚£ãƒƒãƒˆï¼‹æ­£æ–¹å½¢ã€ç”»åƒã¯ã‚«ãƒãƒ¼ */
  .picCard{ position:relative; width:min(100%, var(--card-max)); max-width:var(--card-max); aspect-ratio:1/1; height:auto; border-radius:var(--radius); background:#0f1317; border:1px solid #1f262d; overflow:hidden; box-shadow:0 6px 30px rgba(0,0,0,.35); }
  .picCard .stage{ position:absolute; inset:0; }
  .stage img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity .24s linear; backface-visibility:hidden; transform: translateZ(0);}
  .stage img.active{ opacity:1; }

  .choice-btn{ width:min(100%, var(--card-max)); max-width:var(--card-max); height:var(--btn-h); border-radius:12px; border:1px solid #28323a; background:#161b20; color:#e9eef3; font-size:16px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; padding:0 14px; cursor:pointer; transition:transform .03s ease, background .2s; }
  .choice-btn:hover{ background:#1b2127; }
  .choice-btn:active{ transform:translateY(1px); }

  .tie-btn{ width:100%; height:var(--btn-h); border-radius:999px; border:1px solid #28323a; background:#161b20; color:#e9eef3; cursor:pointer; transition:background .2s; }
  .tie-btn:hover{ background:#1b2127; }
  .tie-btn:focus, .tie-btn:focus-visible{ outline:none; box-shadow:0 0 0 2px rgba(124,255,196,.35); }

  .hidden{display:none !important;}
  .panel{background:#0f1317; border:1px solid #1f262d; border-radius:16px; padding:12px 14px;}
  .toolbar{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
  .toolbar button{height:36px; border-radius:10px; border:1px solid #28323a; background:#12171c; color:#e9eef3; padding:0 10px; cursor:pointer;}
  .toolbar button[disabled]{opacity:.45; cursor:not-allowed;}

  .result{display:grid; gap:8px; margin-top:14px;}
  .rankRow{display:flex; gap:10px; align-items:center; padding:10px; border:1px solid #1f262d; border-radius:12px; background:#0b0f12;}
  .rankNo{font-weight:700; width:44px; text-align:right;}
  .same{font-size:12px; opacity:.7;}
  .footnote{opacity:.65; font-size:12px; margin-top:10px;}

  /* ç«¯æœ«å¹…ã«å¿œã˜ã¦ã¡ã‚‡ã„ç¸®å°ï¼ˆåˆ—ã¯å¸¸ã«3ã¤ã®ã¾ã¾ï¼‰ */
  @media (max-width: 900px){ :root{ --btn-h: 48px; --gap: 10px; --card-max: clamp(130px, 40vw, 320px);} }
  @media (max-width: 600px){ :root{ --gap: 8px;  --card-max: clamp(120px, 38vw, 260px);} }

  /* aspect-ratioæœªå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ */
  @supports not (aspect-ratio: 1/1){
    .picCard{ position:relative; height:auto; }
    .picCard::before{ content:""; display:block; width:100%; padding-top:100%; }
    .picCard .stage{ position:absolute; inset:0; }
  }
</style>
</head>
<body>
<header>
  <h1>AKB48ã‚½ãƒ¼ãƒˆ</h1>
  <div id="progressWrap" class="panel" aria-label="é€²æ—çŠ¶æ³">
    <div id="bar" aria-hidden="true"><i></i></div>
    <div id="pct" aria-live="polite">0%</div>
    <div id="count">æ¯”è¼ƒ: 0 / 0</div>
  </div>
</header>

<main>
  <div class="panel toolbar" style="margin-bottom:14px;">
    <button id="resetBtn" title="æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™">ğŸ”„ ã¯ã˜ã‚ã‹ã‚‰</button>
    <button id="undoBtn" title="1æ‰‹æˆ»ã™" disabled>â†© æˆ»ã™</button>
    <button id="exportBtn" class="hidden" title="çµæœã‚’ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦ä¿å­˜">ğŸ“„ çµæœã‚’ãƒ†ã‚­ã‚¹ãƒˆåŒ–</button>
    <button id="tweetBtn"  class="hidden" title="ä¸Šä½7ä½ã‚’Xã§å…±æœ‰">ğ• çµæœã‚’å…±æœ‰</button>
  </div>

  <div class="arena" id="arena">
    <div class="side">
      <div class="picCard"><div class="stage" id="stageL"></div></div>
      <button class="choice-btn" id="btnL" aria-label="å·¦ã‚’é¸ã¶">(å·¦)</button>
    </div>
    <div class="tieCol">
      <button class="tie-btn" id="btnTie" aria-label="å¼•ãåˆ†ã‘">å¼•ãåˆ†ã‘</button>
    </div>
    <div class="side">
      <div class="picCard"><div class="stage" id="stageR"></div></div>
      <button class="choice-btn" id="btnR" aria-label="å³ã‚’é¸ã¶">(å³)</button>
    </div>
  </div>

  <div id="resultWrap" class="hidden" aria-live="polite">
    <h2 style="margin:10px 0 6px;">æœ€çµ‚çµæœ</h2>
    <div id="resultList" class="result"></div>
    <div class="footnote">â€»åŒç‡ã®å ´åˆã€åŒã˜é †ä½ã§è¡¨ç¤ºã—ã¾ã™ã€‚</div>
  </div>
</main>

<script>
/* ===== ãƒ¡ãƒ³ãƒãƒ¼ ===== */
const MEMBERS = [
"å²©ç«‹æ²™ç©‚","ç¦å²¡è–èœ","å‘äº•åœ°ç¾éŸ³","å°æ —æœ‰ä»¥","å€‰é‡å°¾æˆç¾","å‚å·é™½é¦™","ä¸‹å°¾ã¿ã†","é«™æ©‹å½©éŸ³",
"å¾³æ°¸ç¾šæµ·","æ°¸é‡èŠ¹ä½³","æ©‹æœ¬é™½èœ","åƒè‘‰æµé‡Œ","éˆ´æœ¨ãã‚‹ã¿","ç”°å£æ„›ä½³","é•·å‹å½©æµ·","æ­¦è—¤å°éºŸ",
"å±±å†…ç‘è‘µ","å¤§ç››çœŸæ­©","å¤ªç”°æœ‰ç´€","ä½è—¤ç¶ºæ˜Ÿ","æ©‹æœ¬æµç†å­","ç• å±±å¸Œç¾","å¹³ç”°ä¾‘å¸Œ","å¸ƒè¢‹ç™¾æ¤›",
"æ­£é‹³çœŸå„ª","æ°´å³¶ç¾çµ","å±±ï¨‘ç©º","ç§‹å±±ç”±å¥ˆ","æ–°äº•å½©æ°¸","å·¥è—¤è¯ç´”","ä¹…ä¿å§«èœä¹ƒ","è¿«ç”±èŠ½å®Ÿ",
"æˆç”°é¦™å§«å¥ˆ","å…«æœ¨æ„›æœˆ","å±±å£çµæ„›","ä¼Šè—¤ç™¾èŠ±","å¥¥æœ¬ã‚«ã‚¤ãƒª","å·æ‘çµè¡£","ç™½é³¥æ²™æ€œ","èŠ±ç”°è—è¡£",
"å¤§è³€å½©å§«","è¿‘è—¤æ²™æ¨¹","ä¸¸å±±ã²ãªãŸ"
];

/* ===== å‚ç…§ ===== */
const stageL=document.querySelector("#stageL"), stageR=document.querySelector("#stageR");
const btnL=document.querySelector("#btnL"), btnR=document.querySelector("#btnR"), btnTie=document.querySelector("#btnTie");
const bar=document.querySelector("#bar>i"), pct=document.querySelector("#pct"), countEl=document.querySelector("#count");
const arena=document.querySelector("#arena"), resultWrap=document.querySelector("#resultWrap"), resultList=document.querySelector("#resultList");
const resetBtn=document.querySelector("#resetBtn"), undoBtn=document.querySelector("#undoBtn"), exportBtn=document.querySelector("#exportBtn"), tweetBtn=document.querySelector("#tweetBtn");

/* ===== é€²æ—ã‚¤ãƒ¼ã‚¸ãƒ³ã‚° ===== */
const PROGRESS_EASE_GAMMA = 2.2;
const PROGRESS_START_KICK = 0;
function easedPercent(done, total, finished){
  if (finished) return 100;
  if (!total)   return 100;
  if (done === 0) return 0;
  const x = Math.min(done / total, 0.999);
  const y0 = 1 - Math.pow(1 - x, PROGRESS_EASE_GAMMA);
  const y  = PROGRESS_START_KICK + (1 - PROGRESS_START_KICK) * y0;
  return Math.min(99, Math.max(0, Math.round(y * 100)));
}

/* ===== ç”»åƒãƒãƒƒãƒ— ===== */
let IMAGE_MAP = {};
async function loadImageMapJson(){
  try{
    const res = await fetch("image-map.json", { cache:"no-store" });
    if(!res.ok) return {};
    return await res.json();
  }catch(e){ return {}; }
}
const cache = new Map();
// å†…è”µSVGãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ï¼ˆå¤–éƒ¨ä¾å­˜ãªã—ï¼‰
const placeholderSrc = (name)=>{
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'>
<defs><style><![CDATA[text{font-family: system-ui, -apple-system, Noto Sans JP, Arial; font-size:48px; fill:#cfd5dc;}]]></style></defs>
<rect width='100%' height='100%' fill='#11161b'/>
<text x='50%' y='50%' text-anchor='middle' dominant-baseline='middle'>${name}</text>
</svg>`;
  return `data:image/svg+xml;charset=utf-8,${encodeURIComponent(svg)}`;
};

function ensureStages(stageEl){
  if(stageEl.children.length===0){
    const a=document.createElement("img"), b=document.createElement("img");
    for (const el of [a,b]){ el.decoding="async"; el.referrerPolicy="no-referrer"; el.loading="eager"; el.alt=""; }
    stageEl.appendChild(a); stageEl.appendChild(b); a.className="active";
  }
}
function showImage(stageEl, name){
  ensureStages(stageEl);
  const imgA=stageEl.children[0], imgB=stageEl.children[1];
  const active=imgA.classList.contains("active")?imgA:imgB;
  const idle=active===imgA?imgB:imgA;
  const primary = IMAGE_MAP[name] || placeholderSrc(name);
  const candidates = [primary];
  if(!primary.startsWith("data:")) candidates.push(placeholderSrc(name));
  function swapTo(src){ idle.src=src; idle.alt=name; active.alt=name; requestAnimationFrame(()=>{ active.classList.remove("active"); idle.classList.add("active"); }); }
  function tryLoad(idx){
    const src=candidates[idx];
    if(cache.has(src)) return swapTo(src);
    const tmp=new Image(); tmp.referrerPolicy="no-referrer";
    tmp.onload=()=>{ cache.set(src,true); swapTo(src); };
    tmp.onerror=()=>{ if(idx+1<candidates.length) tryLoad(idx+1); else { const fb=placeholderSrc(name); cache.set(fb,true); swapTo(fb); } };
    tmp.src=src;
  }
  tryLoad(0);
}

/* ===== æ¯”è¼ƒå›æ•°ï¼ˆåˆæœŸä¸Šé™ï¼‹å‹•çš„åˆ†æ¯ï¼‰ ===== */
function computeOptimalTotal(n){
  if(n<=1) return 0;
  const heap = Array(n).fill(1);
  const up=(i)=>{while(i>0){const p=(i-1)>>1;if(heap[p]<=heap[i])break;[heap[p],heap[i]]=[heap[i],heap[p]];i=p;}};
  const down=(i)=>{for(;;){let l=i*2+1,r=l+1,s=i;if(l<heap.length&&heap[l]<heap[s])s=l;if(r<heap.length&&heap[r]<heap[s])s=r;if(s===i)break;[heap[i],heap[s]]=[heap[s],heap[i]];i=s;}};
  for(let i=(heap.length>>1)-1;i>=0;i--) down(i);
  const pop=()=>{const x=heap[0];const y=heap.pop();if(heap.length){heap[0]=y;down(0);}return x;};
  const push=(v)=>{heap.push(v);up(heap.length-1);};
  let total=0; while(heap.length>1){ const a=pop(), b=pop(); total+=(a+b-1); push(a+b);} return total;
}
function huffmanCostFromSizes(sizes){
  const heap = sizes.filter(x=>x>0).slice(); if(heap.length<=1) return 0;
  const up=(i)=>{while(i>0){const p=(i-1)>>1;if(heap[p]<=heap[i])break;[heap[p],heap[i]]=[heap[i],heap[p]];i=p;}};
  const down=(i)=>{for(;;){let l=i*2+1,r=l+1,s=i;if(l<heap.length&&heap[l]<heap[s])s=l;if(r<heap.length&&heap[r]<heap[s])s=r;if(s===i)break;[heap[i],heap[s]]=[heap[s],heap[i]];i=s;}};
  for(let i=(heap.length>>1)-1;i>=0;i--) down(i);
  const pop=()=>{const x=heap[0];const y=heap.pop();if(heap.length){heap[0]=y;down(0);}return x;};
  const push=(v)=>{heap.push(v);up(heap.length-1);};
  let cost=0; while(heap.length>1){ const a=pop(), b=pop(); cost+=(a+b-1); push(a+b);} return cost;
}
function recomputeTotalUpperBound(s){
  const otherSizes = s.runs.map(r=>r.length);
  if(s.active){
    const leftRem = s.active.left.length - s.active.i;
    const rightRem = s.active.right.length - s.active.j;
    const mergedSoFar = s.active.merged.length;
    const pairCost = (leftRem>0 && rightRem>0) ? (leftRem + rightRem - 1) : 0;
    const newRunSize = mergedSoFar + leftRem + rightRem;
    const sizesAfter = newRunSize>0 ? [newRunSize, ...otherSizes] : otherSizes.slice();
    return s.done + pairCost + huffmanCostFromSizes(sizesAfter);
  }
  return s.done + huffmanCostFromSizes(otherSizes);
}

/* ===== State & æ°¸ç¶šåŒ– ===== */
const STORAGE_KEY = "akb-ranker-v5";
function createNewState(names){ return { runs:names.map(n=>[n]), active:null, done:0, total:computeOptimalTotal(names.length), ties:new Map(), finished:false, final:[] }; }
function serializeState(s){ const tiesObj={}; s.ties.forEach((set,k)=>{tiesObj[k]=Array.from(set)}); return JSON.stringify({runs:s.runs,active:s.active,done:s.done,total:s.total,ties:tiesObj,finished:s.finished,final:s.final}); }
function deserializeState(json){ try{ const o=JSON.parse(json); const ties=new Map(Object.entries(o.ties||{}).map(([k,arr])=>[k,new Set(arr)])); return {runs:o.runs,active:o.active,done:o.done,total:o.total,ties,finished:o.finished,final:o.final}; }catch{ return null; } }
function saveState(s){ localStorage.setItem(STORAGE_KEY, serializeState(s)); }
function loadState(){ try{ const raw=localStorage.getItem(STORAGE_KEY); if(!raw) return null; return deserializeState(raw);}catch{ return null; } }
const saveStateDebounced = (()=>{ let t=null; return (s)=>{ clearTimeout(t); t=setTimeout(()=>saveState(s), 16); }; })();

/* ===== ãƒãƒ¼ã‚¸é€²è¡Œ ===== */
function prepareNextPair(s){
  if(s.active && s.active.i < s.active.left.length && s.active.j < s.active.right.length) return;
  if(s.active){
    const a=s.active;
    while(a.i<a.left.length)  a.merged.push(a.left[a.i++]);
    while(a.j<a.right.length) a.merged.push(a.right[a.j++]);
    s.runs.push(a.merged); s.active=null;
  }
  if(s.runs.length===1){ s.finished=true; s.final=s.runs[0]; return; }
  if(s.runs.length>=2){
    s.runs.sort((A,B)=>A.length-B.length);
    const left=s.runs.shift(), right=s.runs.shift();
    s.active = { left, right, i:0, j:0, merged:[] };
    return prepareNextPair(s);
  }
}

/* ===== Undo & æ“ä½œ ===== */
const history=[]; function pushHistory(s){ history.push(serializeState(s)); undoBtn.disabled = history.length===0; }
function undo(){ if(!history.length) return; const snap=history.pop(); const prev=deserializeState(snap); if(prev){ state=prev; render(true); } undoBtn.disabled = history.length===0; }

function pick(s, which){
  if(s.finished) return; prepareNextPair(s); if(s.finished) return;
  pushHistory(s);
  const a=s.active; const L=a.left[a.i], R=a.right[a.j];
  if(which==="L"){ a.merged.push(L); a.i++; }
  else if(which==="R"){ a.merged.push(R); a.j++; }
  else { a.merged.push(L); a.merged.push(R); a.i++; a.j++; if(!s.ties.has(L)) s.ties.set(L,new Set()); if(!s.ties.has(R)) s.ties.set(R,new Set()); s.ties.get(L).add(R); s.ties.get(R).add(L); }
  s.done++; prepareNextPair(s);
}

/* ===== æç”» ===== */
function updateProgress(s){
  const totalDyn = recomputeTotalUpperBound(s);
  if (s.finished) { bar.style.width="100%"; pct.textContent="100%"; countEl.textContent=`æ¯”è¼ƒ: ${s.done} / ${s.done}`; }
  else { const p=easedPercent(s.done,totalDyn,s.finished); bar.style.width=p+"%"; pct.textContent=p+"%"; countEl.textContent=`æ¯”è¼ƒ: ${s.done} / ${totalDyn}`; }
}

function render(skipSave){
  updateProgress(state);
  const finished = !!state.finished;
  exportBtn.classList.toggle("hidden", !finished);
  tweetBtn.classList.toggle("hidden", !finished);
  undoBtn.disabled = history.length===0;
  if(finished){ arena.classList.add("hidden"); resultWrap.classList.remove("hidden"); renderResult(); if(!skipSave) saveStateDebounced(state); return; }
  prepareNextPair(state); if(state.finished){ render(); return; }
  const a=state.active, L=a.left[a.i], R=a.right[a.j];
  showImage(stageL, L); showImage(stageR, R); btnL.textContent=L; btnR.textContent=R;
  arena.classList.remove("hidden"); resultWrap.classList.add("hidden"); if(!skipSave) saveStateDebounced(state);
}

function buildTieGroupsInOrder(){
  const adj=state.ties, seen=new Set(), groups=[];
  for(const name of state.final){ if(seen.has(name)) continue; const group=[], q=[name]; seen.add(name);
    while(q.length){ const u=q.shift(); group.push(u); if(adj.has(u)){ for(const v of adj.get(u)){ if(!seen.has(v)){ seen.add(v); q.push(v); } } } }
    groups.push(group);
  }
  return groups;
}

/* ã‚¿ã‚¤ã¯åŒé †ä½ã§å€‹åˆ¥è¡Œ */
function renderResult(){
  resultList.innerHTML="";
  const groups = buildTieGroupsInOrder();
  let rank = 1;
  for(const group of groups){
    for(const name of group){
      const row=document.createElement("div"); row.className="rankRow";
      const no=document.createElement("div"); no.className="rankNo"; no.textContent=rank;
      const nm=document.createElement("div"); nm.textContent=name;
      row.appendChild(no); row.appendChild(nm);
      resultList.appendChild(row);
    }
    rank += group.length;
  }
}

function buildResultLines(){ const groups=buildTieGroupsInOrder(); const lines=[]; let rank=1; for(const g of groups){ for(const name of g){ lines.push(`${rank}. ${name}`); } rank+=g.length; } return lines; }
function buildTopNLines(n){ const groups=buildTieGroupsInOrder(); const lines=[]; let rank=1; for(const g of groups){ if(rank>n) break; for(const name of g){ lines.push(`${rank}. ${name}`); } rank+=g.length; } return lines; }
function composeTweetTop7(){ const MAX=280, header="AKB48æ¨ã—ã‚½ãƒ¼ãƒˆä¸Šä½7ä½", tags="#AKB48 #æ¨ã—ã‚½ãƒ¼ãƒˆ", lines=buildTopNLines(7); let parts=[header]; for(const line of lines){ const next=parts.join("\n")+"\n"+line; if(next.length<=MAX){ parts.push(line);} else { const remain=lines.length-(parts.length-1); const tail=`â€¦ä»–${remain}è¡Œ`; if((parts.join("\n")+"\n"+tail).length<=MAX) parts.push(tail); break; } } let text=parts.join("\n"); if((text+"\n"+tags).length<=MAX) text += "\n"+tags; return text; }

/* ===== å…¥åŠ›ã‚¤ãƒ™ãƒ³ãƒˆ ===== */
function onChoose(which){ pick(state, which); render(); }
const USE_POINTER = window.PointerEvent !== undefined;
const bind = (el, type, which) => el.addEventListener(type, (e)=>{ e.preventDefault(); onChoose(which); }, { passive:false });
if (USE_POINTER) { bind(btnL,'pointerdown','L'); bind(btnR,'pointerdown','R'); bind(btnTie,'pointerdown','T'); }
else { bind(btnL,'click','L'); bind(btnR,'click','R'); bind(btnTie,'click','T'); }

document.addEventListener("keydown",(e)=>{
  if(e.ctrlKey && e.key.toLowerCase()==='z'){ e.preventDefault(); undo(); return; }
  if(state.finished) return;
  if(e.key==="ArrowLeft"){ onChoose("L"); }
  else if(e.key==="ArrowRight"){ onChoose("R"); }
  else if(e.key==="ArrowDown" || e.key===" "){ e.preventDefault(); onChoose("T"); }
});

resetBtn.addEventListener("click", ()=>{ if(confirm("æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ")){ state=createNewState(MEMBERS.slice()); history.length=0; undoBtn.disabled=true; render(); } });
undoBtn.addEventListener("click", ()=>{ undo(); });
exportBtn.addEventListener("click", ()=>{ if(!state.finished) return; const blob=new Blob([buildResultLines().join("\n")],{type:"text/plain;charset=utf-8"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="akb_ranking.txt"; a.click(); URL.revokeObjectURL(url); });
tweetBtn.addEventListener("click", ()=>{ if(!state.finished) return; const text=composeTweetTop7(); const url="https://twitter.com/intent/tweet?text="+encodeURIComponent(text); window.open(url, "_blank", "noopener"); });

/* ===== åˆæœŸåŒ– ===== */
let state=null;
(async function init(){ IMAGE_MAP = await loadImageMapJson(); state = loadState() ?? createNewState(MEMBERS.slice()); render(); })();

</script>
</body>
</html>
